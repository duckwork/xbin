#!/bin/dash
# spin some shit up, hold X open

. $WMRC
SLOPPY=${SLOPPY:-0}

restart() {
    exec wmwm;
}
trap restart USR1;

wew | while IFS=: read ev wid; do
    . $WMRC
    case $ev in
        7) # XCB_ENTER_NOTIFY
            if [ $SLOPPY -eq 1 ]; then
                wattr o $wid || {
                    fw $wid;
                }
            fi
            ;;
        16) # XCB_CREATE_NOTIFY
            case "$(winfo class $wid)" in
                *)
                    wattr o $wid || {
                        fw $wid;
                    }
                    ;;
            esac
            ;;
        19) # XCB_MAP_NOTIFY
            case "$(winfo class $wid)" in
                [dD]menu)
                    chwso -r $wid;
                    ;;
                *)
                    blur;
                    placew $wid;
                    ;;
            esac
            ;;
        17) # XCB_DESTROY_NOTIFY
            case "$(winfo class $wid)" in
                [dD]menu)
                    ;;
            esac
            ;;
        18) # XCB_UNMAP_NOTIFY
            case "$(winfo class $wid)" in
                [dD]menu)
                    ;;
                *)
                    blur;
                    wattr "$(pfw)" || fw prev;
                    ;;
            esac
            ;;
    esac
done
